<!doctype html>
      
	 <html lang="en-SE">
        <head>
	        <meta charset="UTF-8">
    		<script src="//ajax.googleapis.com/ajax/libs/webfont/1.5.10/webfont.js"></script>
    		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js" type="text/javascript"></script>
			
			<title>The Colors Of Books</title>

        <script src="d3.min.js" charset="utf-8"></script>

		    <script src="thousand.js" type="text/javascript"></script>
			<link rel="stylesheet" href="style.css" />
			<link rel="stylesheet" href="D3style.css" />

		</head>
	
		<body>

		<span id="test"></span>

		<!-- Top section on the site-->  
    <div id="start" class="wrap">
      <div class="startwrap">
            
        <h1 class="header">THE COLORS OF BOOKS</h1>
        <h2 class="tagline">Judging a book by its colors </h2>
        <!-- Intro about the project, what is it that you are looking at? </br>Well the anser is very complicated so we will get back to you. -->

        <a class="page-scroll" href="#intro"><img class="down" src="downwhite.svg"/></a>
      </div>
  </div>

<!-- // INTRO PAGE  -->

<div id="intro" class="wrap">

<!--   <h3 class="intro">A visualization that determines the </br>
     complexity of a book by using a dataset containing the 5000 most common words in English, combined with </br>
    the first 5000 characters of three books. </h3> -->

  <div class="innerwrap">
    <h3 class="intro">Visualizing the complexity of books with color. Created by using a dataset of the <b>5 000 most common words</b> in the English language. We visualize <b>how often these words are used</b> in three very different books.</br></br>
      The darker the book, the more common words are used.
    </h3>
  </div>


</div>

  <div id="sticker" class="">
    <div id="legendwrap">
      <div id="legend" class="legend">Commonness of the word</div>
    </div>
  </div>

  <div id="filling">
    <div id="belowlegend" class="legend">
        &#8804;100 = the word is one of the 100 most common words</div>
    </div>
  </div>

<div id="topwrap" class="wrap">
  <div id="togglewrap"><div id="infotext">Sort words</div>
    <div class="switch">
      <input id="cmn-toggle-4" class="cmn-toggle cmn-toggle-round-flat" type="checkbox">
      <label for="cmn-toggle-4"></label>
    </div>
<!--     <div>Sort words</div> -->
  </div>

  <div id="innertopwrap" class="innerwrap">

<!-- Three small books PAGE -->
    <div id="leftdiv">
      <div id="leftbook" class="smallbook"></div>
      <div class="smalltitle">
        <a class="page-scroll" href="#hamlet"><h4>Hamlet</h4></a>
        <h5>William Shakespeare 1600</h5>

      </div>
    </div>


    <div id="middlediv">
      <div id= "middlebook" class="smallbook"></div>
      <div class="smalltitle">
        <a class="page-scroll" href="#littleprince"><h4>The Little Prince</h4></a>
        <h5>Antoine de Saint Exupery, 1943</h5>
      </div>
    </div>

    <div id="rightdiv">
      <div id= "rightbook" class="smallbook"></div>
      <div class="smalltitle">
        <a class="page-scroll" href="#shades"><h4>50 shades of grey</h4></a>
        <h5>E. L. James, 2011</h5>
      </div>
    </div>
  </div>
</div>

<!-- end three small books -->
<div id="hamlet">
  <div class="wrap bookwrap">
    <div class="innerwrap">

        <div class="smallbookwrap">
            <div id="book1" class="book"></div>
        </div>
      <div class="textwrap">
        <h4>Hamlet</h4>

<h5>Hamlet is a tragedy written by William Shakespeare. Considered among the most powerful and influential tragedies in English literature, it was also his most popular works during his lifetime. 
Set in the Kingdom of Denmark, the play is about the revenge of Hamlet on Claudius who murdered his own brother. The book is often studied in secondary school.</h5>

<t span><h5 class="boom">Common words:</h5><h4 class="boom">75%</h4></t>

      </div>

    </div>
  </div>
</div>

<div id="littleprince">
  <div class="wrap bookwrap">
    <div class="innerwrap">

      <div class="smallbookwrap">
          <div id="book2" class="book"></div>
      </div>
      <div class="textwrap">
        
        <h4>The Little Prince</h4>

<h5>The Little Prince is the most-read and most-translated book in the French language. Written by Antoine de Saint-Éxupéry, The Little Prince is a poetic tale in which a pilot stranded in the desert meets a young prince fallen to Earth from a tiny asteroid. Often used as a beginners book for French language students, it contains a high ratio of common words.</h5>

<t span><h5 class="boom">Common words:</h5><h4 class="boom" style="color: #117475">82%</h4></t>


      </div>

    </div>
  </div>
</div>

<div id="shades">
  <div class="wrap bookwrap">
    <div class="innerwrap">

      <div class="smallbookwrap">
          <div id="book3" class="book"></div>
      </div>
      <div class="textwrap">
        
        <h4>50 Shades of Grey</h4>

<h5>Fifty Shades of Grey, written by E. L. James, is the latest worldwide best seller. An erotic romance, depicting the relationship between a college graduate and a young business man. Originally self-published as an ebook, its prose is seen as poor. (Although the common words percentage just in between that of Hamlet and the childrens book The Little Prince).</h5>

<t span><h5 class="boom">Common words:</h5><h4 class="boom">79%</h4></t>
      </div>

    </div>
  </div>
</div>

         </div>
         <div id="social">

      
           <a target="_blank" href="https://twitter.com/home?status= Judge a book by its color http://thecolorsofbooks.com/"><img src="twitter.png"></a>


         </div>
         <footer>
      
           <h6>By Hyper Island students <a href="mailto:caroline.thordenberg@hyperisland.se">Caroline Thordenberg</a>,<a href="mailto:thomas.boulliot@hyperisland.se">Thomas Boulliot</a>, and 
           <a href="mailto:emelie.norstrom@hyperisland.se">Emelie Norström</a>
           </h6>
         </footer>


		<!-- where to put all scripts <script type="text/javascript" src="jquery.js"></script>-->
		<script type="text/javascript" src="main.js"></script>

    <!--TEST SCRIPT FOR FIXED KEY-->
    <script type="text/javascript">
    $(document).ready(function() {
      var s = $("#sticker");
      var pos = s.position();            
      $(window).scroll(function() {
        var windowpos = $(window).scrollTop();

        if (windowpos >= pos.top) {
          s.addClass("stick")
          s.removeClass("stickycolor");
          $(".list-inline").css("margin-top", 3 + "px");
          ;
        } else {
          s.removeClass("stick");
          s.addClass("stickycolor")
          $(".list-inline").css("margin-top", 14 + "px");
        }
      });
    });
    </script>

		
<!-- ALL THE D3 STUFF PUT IN END OF BODY -->


<script type="text/javascript">


var viewArray = [
  hundred,
  hundred.concat(thousand1),
  hundred.concat(thousand1).concat(thousand2),
  hundred.concat(thousand1).concat(thousand2).concat(thousand3),
  hundred.concat(thousand1).concat(thousand2).concat(thousand3).concat(thousand4),
  hundred.concat(thousand1).concat(thousand2).concat(thousand3).concat(thousand4).concat(thousand5)
];

var margin = {top: 0, right: 0, bottom: 0, left: 0},
width = 500 - margin.left - margin.right,
height = 1000 - margin.top - margin.bottom;



// Parameters & variables
var textsize = 10;
var boxside = 20;
var seetext = true;
var isSorted = false;
var lastJustifyForce = false;
var viewArrayi = 5;
var thousands = viewArray[viewArrayi];
var animationTime = 3000;
var coloranimationTime = 1000;


var widthS = 300,
    heightS = 430,
    textsizeS = 5,
    boxsideS = 4,
    viewArrayiS = 5,
    thousandsS = viewArray[viewArrayiS],
    lastJustifyForceS = false,
    isSortedS = false;

var lines1;
var lines2;
var lines3;
var lines4;
var lines5;
var lines6;
var lastLayoutInput1;
var lastLayoutInput2;
var lastLayoutInput3;
var lastLayoutInput4;
var lastLayoutInput5;
var lastLayoutInput6;
var data1;
var data2;               
var data3;
var data4;
var data5;
var data6;


var strokecolor = "#FFFFFF"
var firstblue = ["#003478", "#335D93", "#6685AE", "#99AEC9", "#CCD6E4"];
var neueblue = ["#117475", "#26948B", "#43B5A5" , "#64D4BB", "#93E8D1", "#BDF7E0", "#DCFFEE"];
var emelieblue = ["#117475", "#21827B", "#2B9992" , "#47ADA5", "#74D2C5", "#A2E8D7", "#DCFFEE"];


$( "#cmn-toggle-4" ).change(function() {
  setCommonAndScales();
  if ($(this).prop('checked'))
    sortSmall();
  else
    resetSmall();
  drawSmall();
});


// function to get width of a text in html
function getWidth(word) {
    return $("#test").text(word).width();
}

// [["foo"]]
// [[{word:"foo", originalIndex:234}]]
function getWord(wordOrObject) {
  return typeof(wordOrObject) == "object"
      ? wordOrObject.word
      : wordOrObject;
}

function getIndex(wordOrObject) {
  return typeof(wordOrObject) == "object"
      ? wordOrObject.index
      : -1;
}

// function to layout one line of text
function layoutLine(line, y, layout, xwidth, forcejustify, svgwidth) {
    var x = 0;
    var fill = svgwidth - xwidth;
    //sätter justify till true eller false. jämförelse är true eller false
    var justify = forcejustify || fill < width * 0.2;
    var add = justify ? fill / (line.length) : 0;

    for (var i = 0; i < line.length; i++) {
      var word = line[i];
        var wordString = getWord(word);
        var cleanword = clean(wordString);
        var wordWidth = getWidth(wordString) + 3 + add;
        layout.push({
            "type": 'word',
            "word": wordString,
            "cleanword": cleanword,
            "common" : isCommon(cleanword),
            "commoni" : commonIndex(cleanword),
            "index": getIndex(word),
            "x": x,
            "y": y,
            "add": add,
            "width": wordWidth
        });
        x += wordWidth;
    }
}

function layoutLines(lines, forcejustify, svgwidth) {
    svgwidth = svgwidth || 500;

    var y = 0;
    var layout = [];
    for (var i = 0; i < lines.length; i++) {
      var line = lines[i];
      var x = 0;
      var workingLine = [];
      for (var j = 0; j < line.length; j++) {
        var word = line[j];
        var wordString = getWord(word);

        if (wordString == "") return;
        var wordWidth = getWidth(wordString) + 3;

        if (x + wordWidth <= svgwidth) {
          // line is not done
          workingLine.push(word);
          x += wordWidth;
        } else {
          // line is already done
          // do something about it
          layoutLine(workingLine, y, layout, x, forcejustify, svgwidth);
          // prepare for next line
          workingLine = [word];
          x = wordWidth;
          y++;
        }
      }
      // layout any remainder of the line
      if (workingLine.length > 0) {
          layoutLine(workingLine, y, layout, x, forcejustify, svgwidth);
      }
      y++;
    }
    return layout;
}

// gets the textfile
function getText(txtfile, callback) {
  $.get( txtfile, function (text) {
    var i = 0;
    var lines = window.lines = text.split('\n')
      .map(function(line) {
        return line
          .trim()
          .split(/\s+/)
          .map(function(word) {
            return {
              "word": word,
              "index": i++
            };
          });
      });

      callback(lines);
    });
}


function start() {

    getText( "books/smallhamlet.txt", function (lines) {
        lines1 = lines;
        lastLayoutInput1 = lines;
        data1 = layoutLines(lastLayoutInput1);
        drawBook(group1A, group1B, data1);
    });
    getText( "books/smallprince.txt", function (lines) {
        lines2 = lines;
        lastLayoutInput2 = lines;
        data2 = layoutLines(lastLayoutInput2);
        drawBook(group2A, group2B, data2);
    });
    getText( "books/smallshades.txt", function (lines) {
        lines3 = lines;
        lastLayoutInput3 = lines;
        data3 = layoutLines(lastLayoutInput3);
        drawBook(group3A, group3B, data3);
    });


};

function draw() {
  drawBook(group1A, group1B, data1);
  drawBook(group2A, group2B, data2);
  drawBook(group3A, group3B, data3);

  //HÄR

};

function sortLayout(layout) {
  layout.sort(function(a,b) {
    return a.index - b.index;
  });
  return layout;
}

//HÄR
function reset() {
  lastLayoutInput1 = lines1;
  lastLayoutInput2 = lines2;
  lastLayoutInput3 = lines3;

  data1 = layoutLines(lastLayoutInput1, false);
  data2 = layoutLines(lastLayoutInput2, false);
  data3 = layoutLines(lastLayoutInput3, false);

  lastJustifyForce = false;
  isSorted = false;
};

function sort() {
  function sortbook(book) {
    var sortedline = [];

    for (var i = 0; i < book.length; i++) {
      var line = book[i];
      for (var j = 0; j < line.length; j++) {
        var word = line[j];
        sortedline.push(word);
      }
    }

    sortedline.sort(function(a,b) {
      var common = commonIndex(clean(getWord(a))) - commonIndex(clean(getWord(b)));
      return common != 0
          ? common
          : a.index - b.index;
    });

    return [sortedline];
  }
//HÄR
  lastLayoutInput1 = sortbook(lines1);
  lastLayoutInput2 = sortbook(lines2);
  lastLayoutInput3 = sortbook(lines3);

  data1 = sortLayout(layoutLines(lastLayoutInput1, true));
  data2 = sortLayout(layoutLines(lastLayoutInput2, true));
  data3 = sortLayout(layoutLines(lastLayoutInput3, true));

  lastJustifyForce = true;
  isSorted = true;
};

//HÄR
function reflow() {
  data1 = layoutLines(lastLayoutInput1, lastJustifyForce);
  data2 = layoutLines(lastLayoutInput2, lastJustifyForce);
  data3 = layoutLines(lastLayoutInput3, lastJustifyForce);

};

function setCommonAndScales() {
  thousands = viewArray[viewArrayi];
  computeCommon();
  $("#test").css("font-size", textsize + "pt");
}

var fontsloaded = false;
var jQueryloaded = false;

// runs when all is loaded
function tryStart() {
  if (fontsloaded && jQueryloaded) {
    setCommonAndScales();
    start();

    setCommonAndScalesSmall();
    startSmall();
  }
}

WebFont.load({
  google: {
    families: ['Merriweather', 'Oswald', 'Noto Sans', 'Josefin Sans:100,300,600,700' ]
  },
  active: function() {
    fontsloaded = true;
    tryStart();
  }
});

jQuery(function() {
  jQueryloaded = true;
  tryStart();
});

// Creates an object of the common words: "Word" : index
var commonObj = {};

function computeCommon() {
  commonObj = {};
  for (var i = 0; i < thousands.length; i++) {
    commonObj[thousands[i]] = i;
  }
}

// Checks if a word is common. Returns True/False
function isCommon(word) {
  return commonObj[word] != undefined;
}

// Returns to common-index of the word
function commonIndex(word) {
  return commonObj[word] != undefined ? commonObj[word] : 5000;
}

// Returned the cleaned up word
function clean(word) {
  return word.replace(/[\.,-\/#!$%\^&\*;:{}=\-_`~()]/g,"").toLowerCase();
}

// D3 SVG and group layout
function drawSVG(foo) {
  return foo.append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.bottom + margin.top)
    .style("margin-left", -margin.left)
    .style("margin.right", -margin.right)
    ;
}
// D3 SVG and group layout
function drawSVGSmall(foo) {
  return foo.append("svg")
    .attr("width", widthS + margin.left + margin.right)
    .attr("height", heightS + margin.bottom + margin.top)
    .style("margin-left", -margin.left)
    .style("margin.right", -margin.right)
    ;
}

// function to append group to whatever is passed
function makeG(foo) {
  return foo.append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
}


// SVG layout
var svg1 = drawSVG(d3.select("#book1"));
var svg2 = drawSVG(d3.select("#book2"));
var svg3 = drawSVG(d3.select("#book3"));
// layout of the smaller ones at the top of page
var svg4 = drawSVGSmall(d3.select("#leftbook"));
var svg5 = drawSVGSmall(d3.select("#middlebook"));
var svg6 = drawSVGSmall(d3.select("#rightbook"));

var group1B = makeG(svg1);
var group1A = makeG(svg1);
var group2B = makeG(svg2);
var group2A = makeG(svg2);
var group3B = makeG(svg3);
var group3A = makeG(svg3);

  // smaller ones at top of page
var group4A = makeG(svg4);
var group4B = makeG(svg4);
var group5A = makeG(svg5);
var group5B = makeG(svg5);
var group6A = makeG(svg6);
var group6B = makeG(svg6);


// Creates a linear blueScale
var blueScale = d3.scale.threshold()
  .domain([100, 1000, 2000, 3000, 4000, 5000])
  .range(neueblue);

// Legend 1
var legend = d3.select('#legend')
  .append('ul')
    .attr('class', 'list-inline');

var keys = legend.selectAll('li.key')
    .data(blueScale.range());


// Lay out li's and give them values and colors after the scale
var getViewArrayi = 0
keys.enter().append('li')
    .attr('class', 'key')
    .attr('value', function(d) {
      // var r = blueScale.invertExtent(d);
      // return r[1] ? r[1] : "rare";
      return getViewArrayi++;
    })
    .style('border-top-color', String)
    .html(function(d) {
        var r = blueScale.invertExtent(d);
        return r[1] ? "&#8804; " + r[1] : "rare";
    });





// D3 happens
// Draws text

function drawText(text) {
  text.classed("text", true)
    .classed("word", true)
    .text(function(d) {
      return d.word;
    })
    .style("opacity", function(d) {
      return seetext ? 1 : 0;
    })
    .style("font-size", textsize + "pt")
    .style("letter-spacing", function(d) {
      return d.add / (d.word.length -1) + "px";
    })
    // .style("font-weight", 100)
    .style("fill", function(d) {
        return "#117475";
    })
    
    .transition().duration(animationTime).ease("quad-out")
    .attr("x", function(d, i) {
      return d.x;
    })
    .attr("y", function(d,i) {
      return d.y * boxside;
    })
    .attr("dx", function(d) { return 1 + "px"; })
    .attr("dy", textsize + 0.5 + "pt")
    .attr("width", function(d) { return d.width; })
    .attr("height", boxside);
}

// Draws rectangles

function drawRect(rect) {
  rect
    .classed("word", true)
    .classed("rect", true)
    .style("opacity", function(d) {
      return 1;
    })
    .style("stroke", function(d) {
      return strokecolor;
    })
    .style("stroke-width", function(d) {
        return d.common ? "0.5pt" : "0.8pt";
    })
    .style("stroke-opacity", function(d) {
        return 0.6;
    })
    .attr("rx", 0.2)
    .attr("ry", 0.2)

    .style("fill", function(d) {
        return blueScale(d.commoni);
    })

    .transition().duration(animationTime).ease("quad-out")
    .attr("x", function(d, i) {
      return d.x;
    })
    .attr("y", function(d,i) {
      return d.y * boxside;
    })
    .attr("width", function(d) { return d.width; })
    .attr("height", boxside);
}



// Draw book

function drawBook(rect, text, words) {

  var bookrect = rect.selectAll("rect")
    .data(words);
  var booktext = text.selectAll("text")
    .data(words);

  //new
  bookrect.enter().append("rect");
  booktext.enter().append("text");

  // new and existing
  drawRect(bookrect);
  drawText(booktext);
}


//// SMAAAAlll ///

function setCommonAndScalesSmall() {
  thousandsS = viewArray[viewArrayiS];
  computeCommon();
  $("#test").css("font-size", textsize + "pt");
}


function startSmall() {
  getText( "books/5000hamlet.txt", function (lines) {
        lines4 = lines;
        lastLayoutInput4 = lines;
        data4 = layoutLines(lastLayoutInput4, false, widthS);
        drawBookSmall(group4A, group4B, data4);
    });
    getText( "books/5000littleprince.txt", function (lines) {
        lines5 = lines;
        lastLayoutInput5 = lines;
        data5 = layoutLines(lastLayoutInput5, false, widthS);
        drawBookSmall(group5A, group5B, data5);
    });
    getText( "books/5000fiftyshadegrey.txt", function (lines) {
        lines6 = lines;
        lastLayoutInput6 = lines;
        data6 = layoutLines(lastLayoutInput6, false, widthS);
        drawBookSmall(group6A, group6B, data6);
    });
};


function drawBookSmall(rect, text, words) {

  var bookrect = rect.selectAll("rect")
    .data(words);
    console.log(words);
  var booktext = text.selectAll("text")
    .data(words);

  //new
  bookrect.enter().append("rect");
  booktext.enter().append("text");

  // new and existing
  drawRectSmall(bookrect);
}



$(".list-inline li").click(function(){
    var value = $(this).attr('value');
    viewArrayiS = value;
    viewArrayi = value;
    setCommonAndScales();
    setCommonAndScalesSmall();

    if (isSorted) {
      sort();
    } else {
      reset();
    };
      
    if (isSortedS) {
      sortSmall();
    } else {
      resetSmall();
    };

    draw();
    drawSmall();
});


function drawSmall() {
  drawBookSmall(group4A, group4B, data4);
  drawBookSmall(group5A, group5B, data5);
  drawBookSmall(group6A, group6B, data6);
};



function resetSmall() {
  lastLayoutInput4 = lines4;
  lastLayoutInput5 = lines5;
  lastLayoutInput6 = lines6;
  data4 = layoutLines(lastLayoutInput4, false, widthS);
  data5 = layoutLines(lastLayoutInput5, false, widthS);
  data6 = layoutLines(lastLayoutInput6, false, widthS);
  lastJustifyForceS = false;
  isSortedS = false;
};


function sortSmall() {
  function sortbook(book) {
    var sortedline = [];

    for (var i = 0; i < book.length; i++) {
      var line = book[i];
      for (var j = 0; j < line.length; j++) {
        var word = line[j];
        sortedline.push(word);
      }
    }

    sortedline.sort(function(a,b) {
      var common = commonIndex(clean(getWord(a))) - commonIndex(clean(getWord(b)));
      return common != 0
          ? common
          : a.index - b.index;
    });

    return [sortedline];
  }

  lastLayoutInput4 = sortbook(lines4);
  lastLayoutInput5 = sortbook(lines5);
  lastLayoutInput6 = sortbook(lines6);
  data4 = sortLayout(layoutLines(lastLayoutInput4, true, widthS));
  data5 = sortLayout(layoutLines(lastLayoutInput5, true, widthS));
  data6 = sortLayout(layoutLines(lastLayoutInput6, true, widthS));
  lastJustifyForceS = true;
  isSortedS = true;
};

function reflowSmall() {
  data4 = layoutLines(lastLayoutInput4, lastJustifyForce, widthS);
  data5 = layoutLines(lastLayoutInput5, lastJustifyForce, widthS);
  data6 = layoutLines(lastLayoutInput6, lastJustifyForce, widthS);
};



function drawRectSmall(rect) {
  rect
    .classed("rect", true)
    .style("opacity", function(d) {
      return 1;
    })
    .style("stroke", function(d) {
      return strokecolor;
    })
    .style("stroke-width", function(d) {
        return d.common ? "0.5pt" : "0.8pt";
    })
    .style("stroke-opacity", function(d) {
        return 0.6;
    })
    .attr("rx", 0.1)
    .attr("ry", 0.1)

    .style("fill", function(d) {
        return blueScale(d.commoni);
    })

    .transition().duration(animationTime).ease("quad-out")
    .attr("x", function(d, i) {
      return d.x;
    })
    .attr("y", function(d,i) {
      return d.y * boxsideS;
    })
    .attr("width", function(d) { return d.width; })
    .attr("height", boxsideS);
}




</script>

		</body> <!-- end of all content-->

	  </html>